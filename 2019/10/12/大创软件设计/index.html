<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>大创软件设计 | Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Bai&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Bai&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">大创软件设计</h1>
            
                <div class="post-meta">
                    

                    
                        <span class="post-time">
                        Date: <a href="#">October 12, 2019&nbsp;&nbsp;11:11:55</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/homework/">homework</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <p>[toc]</p>
<h1 id="一、设计背景"><a href="#一、设计背景" class="headerlink" title="一、设计背景"></a>一、设计背景</h1><h1 id="二、各模块设计"><a href="#二、各模块设计" class="headerlink" title="二、各模块设计"></a>二、各模块设计</h1><h2 id="一-、登录模块"><a href="#一-、登录模块" class="headerlink" title="(一)、登录模块"></a>(一)、登录模块</h2><p>在命令行输入<figure class="highlight plain"><figcaption><span>Text）作为文本框，使用可编辑文本（Edit Text）获取输入的用户信息，使用放置按钮（Push Button）进行登录。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 1.用户名输入框提醒，点击消失</span><br><span class="line"></span><br><span class="line"> 输入框内，提醒内容可以很方便的在输入框（可编辑文本）的String属性中提前加入，并更改ForegroundColor属性以调整颜色 </span><br><span class="line"></span><br><span class="line"> 在ButtonDownFcn函数下，输入以下代码内容： </span><br><span class="line"></span><br><span class="line">```matlab</span><br><span class="line">set(hObject,&apos;String&apos;,&apos;&apos;,&apos;Enable&apos;,&apos;on&apos;);</span><br><span class="line">set(hObject,&apos;ForegroundColor&apos;,[0,0,0]);</span><br><span class="line">uicontrol(hObject);</span><br></pre></td></tr></table></figure></p>
<p>第一行代码为清空输入框内容；</p>
<p>第二行代码为把字体颜色调成默认的黑色；</p>
<p>第三行代码为继续控制GUI界面。如果少了这一句，当点击输入框时，前两行代码正常执行，提示内容消失，但当键盘开始输入时，输入内容会输入在MATLAB的命令行窗口。</p>
<blockquote>
<p><strong>Callback 与 ButtonDownFcn 的区别</strong></p>
<p>两函数的调用要涉及的另一个用于使能或禁用控件的属性 <strong>Enable</strong>，此属性包含三个可选值：{<strong>on</strong>}、off、inactive，on 为默认属性。当 <strong>Enable</strong> 为 <strong>on</strong> 时，在 Push Button上单击左键时，调用 <strong>Callback</strong> 函数，单击右键时，调用 <strong>ButtonDownFcn</strong> 函数。在 Push Button <strong>周围5像素范围内</strong>单击左键或右键，不论 <strong>Enable</strong> 取何值，都将调用 <strong>ButtonDownFcn</strong> 函数。可见，当 <strong>Enable</strong> 为 <strong>on</strong> 时，可以实现单击左键、右键有不同的响应。 </p>
</blockquote>
<p>获取edit文本中的字符串，代码如下：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">global</span> a    <span class="comment">%其中，global定义的变量必须每个变量一个global，否则无法识别</span></span><br><span class="line">a=get(handles.edit,<span class="string">'string'</span>);</span><br><span class="line">str2double(a)</span><br><span class="line">msgbox(<span class="string">'afjda;g'</span>,<span class="string">'帮助信息'</span>,<span class="string">'help'</span>)</span><br><span class="line">errordlg(<span class="string">''</span>,<span class="string">''</span>,<span class="string">''</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-保护输入密码的显示"><a href="#2-保护输入密码的显示" class="headerlink" title="2.保护输入密码的显示"></a>2.保护输入密码的显示</h4><ul>
<li>方法一：</li>
</ul>
<p>如果不强调一定要用星号来隐藏所输入的密码字符，则可以直接设置Edit Text控件的属性“FontName”来完成密码隐藏功能。</p>
<p>具体地，双击用作输入密码的Edit Text控件，打开其属性设置面板（Property Inspector ），找到属性“FontName”，默认的字体名为“MS Sans Serif”，将字体改为“Symbol”，即可完成密码隐藏功能。</p>
<ul>
<li>方法二：</li>
</ul>
<p>不改变字体，而是通过代码，修改用作输入密码的Edit Text控件的“KeyPressFcn”函数。具体地：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">global</span> passWord</span><br><span class="line"> </span><br><span class="line">passWord = get( hObject, <span class="string">'UserData'</span> );</span><br><span class="line"><span class="keyword">switch</span> eventdata.Key</span><br><span class="line">   <span class="keyword">case</span> <span class="string">'backspace'</span></span><br><span class="line">      passWord = passWord( <span class="number">1</span>:<span class="keyword">end</span><span class="number">-1</span> );</span><br><span class="line">   <span class="keyword">case</span> <span class="string">'return'</span></span><br><span class="line"><span class="comment">%       uiresume;</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   <span class="keyword">otherwise</span></span><br><span class="line">      passWord = [passWord eventdata.Character];</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">set( hObject, <span class="string">'UserData'</span>, passWord );</span><br><span class="line">set( hObject, <span class="string">'String'</span>, char( <span class="string">'*'</span>*<span class="built_in">sign</span>(passWord) ) );</span><br></pre></td></tr></table></figure>

<p> 其中 passWord 即为输入的密码字符串 , 该方法唯一不足之处在于，输入密码时，光标始终在左边！ </p>
<h4 id="3-修改左上角标题名称"><a href="#3-修改左上角标题名称" class="headerlink" title="3.修改左上角标题名称"></a>3.修改左上角标题名称</h4><p> 在程序的OpeningFcn函数中加入这么一句命令：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set(gcf,<span class="string">'numbertitle'</span>,<span class="string">'off'</span>,<span class="string">'name'</span>,<span class="string">'标题名称'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="4-登录按钮设置"><a href="#4-登录按钮设置" class="headerlink" title="4.登录按钮设置"></a>4.登录按钮设置</h4> <figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pushbutton1_Callback</span><span class="params">(hObject, eventdata, handles)</span></span></span><br><span class="line"><span class="comment">% 登录按钮</span></span><br><span class="line"><span class="keyword">global</span> cName;</span><br><span class="line"><span class="keyword">global</span> cCode;</span><br><span class="line"><span class="keyword">if</span>( ~strcmp(cName,<span class="string">'12345678910'</span>) || ~strcmp(cCode , <span class="string">'971122'</span>) )</span><br><span class="line">    errordlg(<span class="string">'用户名或密码错误'</span>,<span class="string">'错误提醒'</span>,<span class="string">'modal'</span>);</span><br><span class="line">    set(handles.edit2,<span class="string">'string'</span>,<span class="string">''</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    close;</span><br><span class="line">    GEST;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>其中，GEST为登陆后的程序界面<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 5.用户信息数据库</span><br><span class="line"></span><br><span class="line">使用cell形式存储，建立mat数据库文件，本软件采用上述唯一账号密码，故略去数据库的建立。</span><br><span class="line"></span><br><span class="line">#### 6.插入背景图片</span><br><span class="line"></span><br><span class="line">```matlab</span><br><span class="line">ha=axes(&apos;units&apos;,&apos;normalized&apos;,&apos;pos&apos;,[0 0 1 1]);</span><br><span class="line">uistack(ha,&apos;down&apos;);</span><br><span class="line">ii=imread(&apos;background.jpg&apos;);</span><br><span class="line">image(ii);</span><br><span class="line">colormap gray</span><br><span class="line">set(ha,&apos;handlevisibility&apos;,&apos;off&apos;,&apos;visible&apos;,&apos;on&apos;);</span><br></pre></td></tr></table></figure></p>
<h2 id="二-、主窗体设计"><a href="#二-、主窗体设计" class="headerlink" title="(二)、主窗体设计"></a>(二)、主窗体设计</h2><p>包括建立各级子菜单</p>
<h4 id="1-建立按钮中断其他回调，使用waitfor"><a href="#1-建立按钮中断其他回调，使用waitfor" class="headerlink" title="1)建立按钮中断其他回调，使用waitfor"></a>1)建立按钮中断其他回调，使用waitfor</h4><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在将数据添加到表之前，等待用户选中复选框。复选框的 Value 属性在未选中时为 <span class="number">0</span>，在选中时为 <span class="number">1</span>。</span><br><span class="line"></span><br><span class="line">t = uitable;</span><br><span class="line">c = uicontrol(<span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="string">'String'</span>,<span class="string">'Add data'</span>);</span><br><span class="line">c.Position = [<span class="number">320</span> <span class="number">100</span> <span class="number">80</span> <span class="number">20</span>];</span><br><span class="line">waitfor(c,<span class="string">'Value'</span>);</span><br><span class="line">t.Data = <span class="built_in">magic</span>(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<h4 id="2-建立waitbar"><a href="#2-建立waitbar" class="headerlink" title="2)建立waitbar"></a>2)建立waitbar</h4><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">h=waitbar(<span class="number">0</span>,<span class="string">'please wait'</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="number">1000</span></span><br><span class="line">    <span class="comment">%computation here%</span></span><br><span class="line">    b=num2str(<span class="built_in">round</span>(<span class="built_in">i</span>/<span class="number">10</span>));</span><br><span class="line">     s=[<span class="string">'please wait:'</span> ,b ,<span class="string">'%'</span>];</span><br><span class="line">    waitbar(<span class="built_in">i</span>/<span class="number">1000</span>,h,s)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">delete(h);</span><br></pre></td></tr></table></figure>

<h4 id="3-弹出输入框"><a href="#3-弹出输入框" class="headerlink" title="3)弹出输入框"></a>3)弹出输入框</h4><p>常见用法<br><code>answer = inputdlg(prompt,dlgtitle,numlines,defAns);</code><br>prompt显示内容<br>dlgtitle 标题<br>numlines输入框长度<br>defAns默认输入值<br>answer为输入的数据，以元胞数组的形式储存在里面，而且储存的数据形式都是字符串</p>
<h4 id="4-提问对话框"><a href="#4-提问对话框" class="headerlink" title="4)提问对话框"></a>4)提问对话框</h4><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = questdlg(<span class="string">'中午吃饭了吗？'</span>,<span class="string">'问题提示'</span>,<span class="string">'Yes'</span>,<span class="string">'No'</span>,<span class="string">'Yes'</span>); </span><br><span class="line"># 最后一个Yes 表示对话框默认选项，即弹出式，Yes选项会深色显示</span><br><span class="line">button = questdlg(<span class="string">'qstring'</span>,<span class="string">'title'</span>,<span class="string">'str1'</span>,<span class="string">'str2'</span>,<span class="string">'str3'</span>,default)</span><br></pre></td></tr></table></figure>

<blockquote>
<h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p><code>button = questdlg(&#39;qstring&#39;)</code> displays a modal dialog box presenting the question <code>&#39;qstring&#39;</code>. The dialog has three default buttons, <strong>Yes</strong>, <strong>No</strong>, and <strong>Cancel</strong>. If the user presses one of these three buttons, <code>button</code> is set to the name of the button pressed. If the user presses the close button on the dialog without making a choice, <code>button</code> is set to the empty string. If the user presses the <strong>Return</strong> key, button is set to <code>&#39;Yes&#39;</code>. <code>&#39;qstring&#39;</code> is a cell array or a string that automatically wraps to fit within the dialog box.</p>
</blockquote>
<p>一行输入框：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clc;clear;close all;</span><br><span class="line">answer=inputdlg(<span class="string">'a=？'</span>,<span class="string">'输入'</span>,[<span class="number">1</span> <span class="number">30</span>],&#123;<span class="string">'5'</span>&#125;);</span><br></pre></td></tr></table></figure>

<p>多行输入框：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">clc;clear;close all;</span><br><span class="line">answer=inputdlg(&#123;<span class="string">'姓名'</span>,<span class="string">'阶数'</span>&#125;,<span class="string">'请输入'</span>,[<span class="number">1</span> <span class="number">30</span>;<span class="number">1</span> <span class="number">30</span>],&#123;<span class="string">'ABC'</span>,<span class="string">'30'</span>&#125;);</span><br><span class="line">peaks(str2num(answer&#123;<span class="number">2</span>&#125;));</span><br><span class="line">msgbox([answer&#123;<span class="number">1</span>&#125;,<span class="string">'您好您当前正在执行的是'</span>,<span class="string">'peaks('</span>,answer&#123;<span class="number">2</span>&#125;,<span class="string">')'</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="三-、数据导入及存储模块"><a href="#三-、数据导入及存储模块" class="headerlink" title="(三)、数据导入及存储模块"></a>(三)、数据导入及存储模块</h2><h4 id="1-数据导入"><a href="#1-数据导入" class="headerlink" title="1.数据导入"></a>1.数据导入</h4><p>输入格式应包括txt、mat、dat等格式，由于对应于一个函数，打开的文件无法始终保存在工作空间之中，因此传递一个global变量记录文件路径，供其他模块调用。</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Untitled_6_Callback</span><span class="params">(hObject, eventdata, handles)</span></span></span><br><span class="line"><span class="comment">% 打开文件</span></span><br><span class="line">[file_name,path_name] = uigetfile(&#123;<span class="string">'*.mat'</span>;<span class="string">'*.dat'</span>;<span class="string">'*.txt'</span>&#125;,<span class="string">'打开文件'</span>);</span><br><span class="line"><span class="comment">%在电脑中查找文件，弹出浏览窗口，‘打开文件’为左上角标题，文件名和路径存储在name和path变量之中，但此时未导入变量</span></span><br><span class="line"><span class="keyword">global</span> file_path</span><br><span class="line">file_path = [path_name file_name]</span><br><span class="line">fid = fopen(file_path)</span><br><span class="line"><span class="keyword">if</span> (fid &gt; <span class="number">0</span>)</span><br><span class="line"><span class="comment">%     h=dialog('name','文件','position',[200 200 200 70]);</span></span><br><span class="line"><span class="comment">%     uicontrol('parent',h,'style','text','string','文件打开成功','position',[50 40 120 20],'fontsize',12);</span></span><br><span class="line"><span class="comment">%     uicontrol('parent',h,'style','pushbutton','position',[80 10 50 20],'string','确定','callback','delete(gcbf)');</span></span><br><span class="line">    msgbox(<span class="string">'文件打开成功'</span>,<span class="string">'文件'</span>,<span class="string">'help'</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    h=errordlg(<span class="string">'文件打开失败'</span>,<span class="string">'error'</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">li = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ~feof(fid)</span><br><span class="line">    tline = fgetl(fid);</span><br><span class="line">    li = li+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span> line_num</span><br><span class="line">line_num = li</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">% hObject    handle to Untitled_6 (see GCBO)</span></span><br><span class="line"><span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span></span><br><span class="line"><span class="comment">% handles    structure with handles and user data (see GUIDATA)</span></span><br></pre></td></tr></table></figure>

<p>当使用load 命令时，若加路径名称，需要使用括号，如 data =  load(‘D:\a.mat’)</p>
<p>此时data 为一个 struct 结构体，若想转换为矩阵，则需要先转换为 cell ,再由cell转换为 mat,具体命令如下：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = cell2mat(struct2cell(load(<span class="string">'a.mat'</span>)));</span><br></pre></td></tr></table></figure>

<p>判断load 的mat 文件中包含的变量个数：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[file_name,path_name] = uigetfile(&#123;<span class="string">'*.mat'</span>;<span class="string">'*.dat'</span>;<span class="string">'*.txt'</span>&#125;,<span class="string">'打开文件'</span>);</span><br><span class="line"><span class="comment">%在电脑中查找文件，弹出浏览窗口，‘打开文件’为左上角标题，文件名和路径存储在name和path变量之中，但此时未导入变量</span></span><br><span class="line"><span class="keyword">global</span> file_path</span><br><span class="line">file_path = [path_name file_name]</span><br><span class="line"><span class="comment">% d = cell2mat(struct2cell(load(file_path)));</span></span><br><span class="line">b=whos('-file',file_path) # b 为struct 形式，变量个数为n,b的大小为nx1</span><br><span class="line">c=<span class="built_in">size</span>(b)</span><br><span class="line">sum(c)</span><br></pre></td></tr></table></figure>

<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%open file</span></span><br><span class="line">[file_name,path_name] = uigetfile(&#123;<span class="string">'*.mat'</span>;<span class="string">'*.dat'</span>;<span class="string">'*.txt'</span>&#125;,<span class="string">'打开文件'</span>);</span><br><span class="line"><span class="keyword">global</span> file_path</span><br><span class="line">file_path = [path_name file_name] ;</span><br><span class="line"><span class="keyword">global</span> data</span><br><span class="line"><span class="keyword">if</span> (strcmp(file_name(<span class="keyword">end</span><span class="number">-3</span>:<span class="keyword">end</span>) , <span class="string">'.mat'</span>))</span><br><span class="line">    b=whos(<span class="string">'-file'</span>,file_path);</span><br><span class="line">    c=<span class="built_in">size</span>(b);</span><br><span class="line">    <span class="keyword">if</span>(sum(c) ~= <span class="number">2</span>)</span><br><span class="line">        errordlg(<span class="string">'输入数据应只包含一个变量'</span>,<span class="string">'错误'</span>,<span class="string">'modal'</span>);</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">data = cell2mat(struct2cell(load(file_path))) ;</span><br><span class="line">imagesc(data(:,:,<span class="number">1</span>))</span><br><span class="line">aa = msgbox(<span class="string">'导入成功'</span>,<span class="string">'OK'</span>,<span class="string">'help'</span>);</span><br><span class="line">pause(<span class="number">1</span>)</span><br><span class="line">delete(aa)</span><br></pre></td></tr></table></figure>

<h4 id="2-文件存储"><a href="#2-文件存储" class="headerlink" title="2.文件存储"></a>2.文件存储</h4><h5 id="1）存储当前窗口图片"><a href="#1）存储当前窗口图片" class="headerlink" title="1）存储当前窗口图片"></a>1）存储当前窗口图片</h5><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uipushtool3_ClickedCallback</span><span class="params">(hObject, eventdata, handles)</span></span></span><br><span class="line"><span class="comment">% 保存图片</span></span><br><span class="line">[filename,pathname] = uiputfile(&#123;<span class="string">'*.jpg'</span>;<span class="string">'*.bmp'</span>;<span class="string">'*.gif'</span>;<span class="string">'*.png'</span>;<span class="string">'*.tif'</span>&#125;, <span class="string">'Write Pic'</span>);</span><br><span class="line">str=[pathname filename];</span><br><span class="line"><span class="keyword">if</span> str~=<span class="number">0</span></span><br><span class="line">    saveas(gcf,str);  </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% --- 文件的保存 ---</span></span><br><span class="line">	[file,path] = uiputfile(<span class="string">'*.mat'</span>,<span class="string">'Save Mask As'</span>);</span><br><span class="line">    save(strcat(path,file),<span class="string">'mask'</span>);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="comment">% --- 创建一个进度条 ---</span></span><br><span class="line">	wait = waitbar(<span class="number">0.1</span>,<span class="string">'Loading data from disk...'</span>);</span><br><span class="line">	waitbar(<span class="number">0.2</span>,wait);</span><br><span class="line">	waitbar(<span class="number">1.0</span>,wait);</span><br><span class="line">	close(wait);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="comment">% --- 在名为display的axes显示图像，然后关闭 ---</span></span><br><span class="line">	img = imagesc(data, <span class="string">'Parent'</span>,handles.display);</span><br><span class="line">	close img;</span><br></pre></td></tr></table></figure>

<h5 id="2-保存数据"><a href="#2-保存数据" class="headerlink" title="2)保存数据"></a>2)保存数据</h5><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">save(<span class="string">'data.mat'</span>,<span class="string">'a'</span>,<span class="string">'b'</span>)的方式，data.mat是生成的mat文件名，a和b是存入的变量</span><br></pre></td></tr></table></figure>

<p>保存对当前文件的更改：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">global</span> file_path</span><br><span class="line">save(file_path,<span class="string">'data'</span>)</span><br><span class="line">msgbox(<span class="string">'文件已保存'</span>,<span class="string">'OK'</span>,<span class="string">'help'</span>)</span><br></pre></td></tr></table></figure>

<p>文件另存为：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[filename,pathname] = uiputfile(&#123;<span class="string">'*.mat'</span>;<span class="string">'*.dat'</span>;<span class="string">'*.txt'</span>&#125;, <span class="string">'另存为'</span>);</span><br><span class="line">str=[pathname filename]</span><br><span class="line">save(str,<span class="string">'data'</span>)</span><br><span class="line">msgbox(<span class="string">'文件已保存'</span>,<span class="string">'OK'</span>,<span class="string">'help'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="四-、正演模块"><a href="#四-、正演模块" class="headerlink" title="(四)、正演模块"></a>(四)、正演模块</h2><h4 id="1-速度模型"><a href="#1-速度模型" class="headerlink" title="1.速度模型"></a>1.速度模型</h4><h5 id="1）marmousi模型"><a href="#1）marmousi模型" class="headerlink" title="1）marmousi模型"></a>1）marmousi模型</h5><p>提供计算好的结果</p>
<h4 id="2-参数设置"><a href="#2-参数设置" class="headerlink" title="2.参数设置"></a>2.参数设置</h4><h4 id="3-波场快照"><a href="#3-波场快照" class="headerlink" title="3.波场快照"></a>3.波场快照</h4><h5 id="暂停-继续-设置"><a href="#暂停-继续-设置" class="headerlink" title="暂停/继续 设置"></a>暂停/继续 设置</h5><p>在<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">由于点击```暂停/继续```按钮后，不再激活```开始```按钮的回调函数，故将```开始```的回调函数复制进该按钮。</span><br><span class="line"></span><br><span class="line">下面为```暂停/继续```的代码：</span><br><span class="line"></span><br><span class="line">```matlab</span><br><span class="line">function pushbutton8_Callback(hObject, eventdata, handles)</span><br><span class="line">global val</span><br><span class="line">if(val == 0)       %实现开关作用</span><br><span class="line">    val=1</span><br><span class="line">else</span><br><span class="line">    val = 0</span><br><span class="line">    return;         %此处必须return，否则进入while中的循环，无法退出</span><br><span class="line">end</span><br><span class="line">global k            %使得“继续”命令后能使图像连续，传入参数</span><br><span class="line">global u</span><br><span class="line">global mdd</span><br><span class="line">    [a,b]=meshgrid(0:24:24*383,0:24:24*121);</span><br><span class="line">while(k&lt;=60)</span><br><span class="line">    if (val)</span><br><span class="line">                imagesc(0:24:24*383,0:24:24*121,u(:,:,k),[-1,1])</span><br><span class="line">                 title([&apos;波场快照 第 &apos;,num2str(k*0.02),&apos; s&apos;])</span><br><span class="line">                hold on</span><br><span class="line">                 contour(a,b,mdd,&apos;k&apos;)</span><br><span class="line">                 hold on</span><br><span class="line">                 plot(24*(384)/2,20,&apos;pr&apos;,&apos;MarkerSize&apos;,13)</span><br><span class="line">                 text(24*(384)/2+35,80,&apos;震源&apos;,&apos;FontSize&apos;,11)</span><br><span class="line">                h2=colorbar;</span><br><span class="line">                set(get(h2,&apos;Title&apos;),&apos;string&apos;,&apos;u &apos;);</span><br><span class="line">                colormap(jet)</span><br><span class="line">               k=k+1;</span><br><span class="line">    end</span><br><span class="line">    pause(0.1)</span><br><span class="line">end</span><br></pre></td></tr></table></figure></p>
<h5 id="清空当前窗口图像"><a href="#清空当前窗口图像" class="headerlink" title="清空当前窗口图像"></a>清空当前窗口图像</h5><p>使用命令<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### 翻页、跳转页面操作</span><br><span class="line"></span><br><span class="line">由于自动放映时，暂停后对k 多加了一个1，采用新增变量page判断是否经过暂停k多加1的过程。</span><br><span class="line"></span><br><span class="line">代码如下：</span><br><span class="line"></span><br><span class="line">```matlab</span><br><span class="line">function pushbutton5_Callback(hObject, eventdata, handles)</span><br><span class="line">%上一页</span><br><span class="line">global k</span><br><span class="line">global u </span><br><span class="line">global a </span><br><span class="line">global b </span><br><span class="line">global mdd</span><br><span class="line">global val</span><br><span class="line">global page</span><br><span class="line">if(val == 0 &amp;&amp; page == 0)   %判断之前操作是否为暂停</span><br><span class="line">    k=k-1;</span><br><span class="line">    page = 1;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">if (k==1)</span><br><span class="line">    msgbox(&apos;当前为第一页&apos;,&apos;错误&apos;,&apos;error&apos;);</span><br><span class="line">else</span><br><span class="line">    k=k-1;</span><br><span class="line">     imagesc(0:24:24*383,0:24:24*121,u(:,:,k),[-1,1])</span><br><span class="line">                 title([&apos;波场快照 第 &apos;,num2str(k*0.02),&apos; s&apos;])</span><br><span class="line">                hold on</span><br><span class="line">                 contour(a,b,mdd,&apos;k&apos;)</span><br><span class="line">                 hold on</span><br><span class="line">                 plot(24*(384)/2,20,&apos;pr&apos;,&apos;MarkerSize&apos;,13)</span><br><span class="line">                 text(24*(384)/2+35,80,&apos;震源&apos;,&apos;FontSize&apos;,11)</span><br><span class="line">                h2=colorbar;</span><br><span class="line">                set(get(h2,&apos;Title&apos;),&apos;string&apos;,&apos;u &apos;);</span><br><span class="line">                colormap(jet)</span><br><span class="line">end</span><br></pre></td></tr></table></figure></p>
<h4 id="4-合成地震记录"><a href="#4-合成地震记录" class="headerlink" title="4.合成地震记录"></a>4.合成地震记录</h4><p>单炮激发，某个深度下，同一水平层所有时间位移响应构成的二维矩阵</p>
<h4 id="5-模型图"><a href="#5-模型图" class="headerlink" title="5.模型图"></a>5.模型图</h4><h4 id="6-噪声"><a href="#6-噪声" class="headerlink" title="6.噪声"></a>6.噪声</h4><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">answer=inputdlg(<span class="string">'噪声幅值'</span>,<span class="string">'input rand noise'</span>,[<span class="number">1</span> <span class="number">30</span>],&#123;<span class="string">'1'</span>&#125;);</span><br><span class="line">a = str2num(answer&#123;<span class="number">1</span>&#125;);</span><br><span class="line"><span class="keyword">global</span> data</span><br><span class="line">[nx,ny,nz]=<span class="built_in">size</span>(data);</span><br><span class="line">noise = data + a*<span class="built_in">rand</span>(nx,ny,nz) ;</span><br><span class="line">[filename,pathname] = uiputfile(&#123;<span class="string">'*.mat'</span>;<span class="string">'*.dat'</span>;<span class="string">'*.txt'</span>&#125;, <span class="string">'另存为'</span>);</span><br><span class="line">str=[pathname filename]</span><br><span class="line">save(str,<span class="string">'noise'</span>)</span><br><span class="line">msgbox(<span class="string">'文件已保存'</span>,<span class="string">'OK'</span>,<span class="string">'help'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="7-SVI处理"><a href="#7-SVI处理" class="headerlink" title="7.SVI处理"></a>7.SVI处理</h4><p>新建一个gui 界面，具体实现见SVI模块</p>
<blockquote>
<p>svi原理：</p>
<p>地震炮集记录中，特别是陆地地震数据，<strong>远偏移距数据由于信号能量弱，噪声干扰大</strong>，往往很难得到有效的初至时地震波记录。</p>
<p>​     采用超分辨率地震干涉技术对地震炮集记录进行增强处理，其基本原理是对每一个检波器记录信号利用互相关和卷积方法进行处理。通过数值模拟和实测数据测试，形成一套完整的超分辨率地震干涉处理方法  </p>
</blockquote>
<h2 id="五-、SVI模块"><a href="#五-、SVI模块" class="headerlink" title="(五)、SVI模块"></a>(五)、SVI模块</h2><h5 id="1-窗口化"><a href="#1-窗口化" class="headerlink" title="1.窗口化"></a>1.窗口化</h5><p>从地震记录图中使用鼠标截取窗口进行过滤处理。</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">a=peaks(<span class="number">100</span>);  <span class="comment">%a是个二维矩阵</span></span><br><span class="line"> imagesc(a);      <span class="comment">%利用二维矩阵a画图，会生成一个figure窗口</span></span><br><span class="line"></span><br><span class="line">h=imrect(gca)         <span class="comment">%运行完这句后，可以在图中框出需要的区域</span></span><br><span class="line"></span><br><span class="line">pos = getPosition(h); <span class="comment">%待区域决定后，运行这句就会返回区域的位置和大小</span></span><br><span class="line"><span class="comment">%pos返回的是四个值</span></span><br><span class="line"><span class="comment">%  [xmin ymin width height].</span></span><br><span class="line">col=<span class="built_in">round</span>(pos(<span class="number">1</span>)):<span class="built_in">round</span>(pos(<span class="number">1</span>)+pos(<span class="number">3</span>));  <span class="comment">%根据pos计算lie下标</span></span><br><span class="line">row=<span class="built_in">round</span>(pos(<span class="number">2</span>)):<span class="built_in">round</span>(pos(<span class="number">2</span>)+pos(<span class="number">4</span>));    <span class="comment">%根据pos计算hang下标</span></span><br><span class="line"><span class="comment">%由于pos返回有小数，用round取整</span></span><br><span class="line"></span><br><span class="line">b=a(row,col);                                                <span class="comment">%根据row，col，从a中提取矩阵b</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">figure</span></span><br><span class="line">imagesc(b)</span><br></pre></td></tr></table></figure>

<p>使用鼠标点击提取点坐标</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Untitled_7_Callback</span><span class="params">(hObject, eventdata, handles)</span></span></span><br><span class="line"><span class="comment">% 选择窗口</span></span><br><span class="line"><span class="built_in">figure</span></span><br><span class="line"><span class="keyword">global</span> data</span><br><span class="line">imagesc(data(:,:,<span class="number">1</span>))</span><br><span class="line">x1=[];y1=[];</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> =<span class="number">1</span>:<span class="number">4</span></span><br><span class="line">[a,b] = ginput(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">hold</span> on</span><br><span class="line">x1=[x1;a];</span><br><span class="line">y1=[y1;b];</span><br><span class="line"><span class="built_in">plot</span>(a,b,<span class="string">'ro'</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">plot</span>(x1,y1,<span class="string">'r'</span>)</span><br><span class="line"></span><br><span class="line">x2=[];y2=[];</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> =<span class="number">1</span>:<span class="number">4</span></span><br><span class="line">[c,d] = ginput(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">hold</span> on</span><br><span class="line">x2=[x2;c];</span><br><span class="line">y2=[y2;d];</span><br><span class="line"><span class="built_in">plot</span>(c,d,<span class="string">'ro'</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">plot</span>(x2,y2,<span class="string">'r'</span>)</span><br><span class="line"></span><br><span class="line">ax =[x1 y1 x2 y2];</span><br><span class="line">[filename,pathname] = uiputfile(&#123;<span class="string">'*.mat'</span>&#125;, <span class="string">'保存坐标'</span>);</span><br><span class="line">str=[pathname filename];</span><br><span class="line">save(str,<span class="string">'ax'</span>)</span><br><span class="line">msgbox(<span class="string">'文件已保存'</span>,<span class="string">'OK'</span>,<span class="string">'help'</span>)</span><br></pre></td></tr></table></figure>

<p>依据鼠标获取的坐标，使用带通滤波函数，将选取部分保留，其余部分归零，得到窗口。</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[nt,ng,ns]=<span class="built_in">size</span>(data);</span><br><span class="line"></span><br><span class="line">Normalize=<span class="number">1</span>;        <span class="comment">% 0 = no normalization, 1 = CSG normalization, 2 = Trace normalization</span></span><br><span class="line">bp=<span class="number">0</span>;               <span class="comment">% 0 = no bandpass, 1 = do bandpass</span></span><br><span class="line">lcut=<span class="number">5</span>;</span><br><span class="line">lpass=<span class="number">10</span>;</span><br><span class="line">hpass=<span class="number">80</span>;</span><br><span class="line">hcut=<span class="number">110</span>;</span><br><span class="line">ntr=<span class="number">3</span>;              <span class="comment">% number of traces to mute at right and left sides of the shot</span></span><br><span class="line">mut_r=<span class="number">1</span>;            <span class="comment">% Mute around refracted waves  消减附件反射波</span></span><br><span class="line">tap_size=<span class="number">20</span>;        <span class="comment">% Size of taper window around refracted waves, in samples</span></span><br><span class="line"></span><br><span class="line">uper=(<span class="number">1</span>:ng)';</span><br><span class="line">lower=uper;</span><br><span class="line">uper(:,<span class="number">2</span>)=interp1(uperT(:,<span class="number">1</span>),uperT(:,<span class="number">2</span>),uper(:,<span class="number">1</span>));</span><br><span class="line">lower(:,<span class="number">2</span>)=interp1(lowerT(:,<span class="number">1</span>),lowerT(:,<span class="number">2</span>),lower(:,<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> is=<span class="number">1</span>:ns   <span class="comment">%每个炮点位置 </span></span><br><span class="line">    pos = is*dx<span class="number">-4</span>;</span><br><span class="line">    cg=data(:,:,is);</span><br><span class="line">    <span class="keyword">if</span> bp==<span class="number">1</span></span><br><span class="line">        cg=BandPass(cg,lcut,lpass,hpass,hcut,dt);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">if</span> ntr&gt;<span class="number">0</span>   <span class="comment">%震源两侧削弱道数</span></span><br><span class="line">        st=pos-ntr;     <span class="comment">%is为列号，即当前震源位置所在列</span></span><br><span class="line">        ed=pos+ntr;</span><br><span class="line">        <span class="keyword">if</span> st&lt;<span class="number">1</span>;st=<span class="number">1</span>;<span class="keyword">end</span></span><br><span class="line">        <span class="keyword">if</span> ed&gt;ng;ed=ng;<span class="keyword">end</span></span><br><span class="line">        cg(:,st:ed)=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">if</span> Normalize==<span class="number">1</span> &amp;&amp; <span class="built_in">max</span>(<span class="built_in">abs</span>(cg(:)))~=<span class="number">0</span>   <span class="comment">%地震记录数据归一化</span></span><br><span class="line">        cg=cg/<span class="built_in">max</span>(<span class="built_in">abs</span>(cg(:)));</span><br><span class="line">    <span class="keyword">elseif</span> Normalize==<span class="number">2</span></span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:ng</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">max</span>(<span class="built_in">abs</span>(cg(:,<span class="built_in">j</span>)))~=<span class="number">0</span></span><br><span class="line">                cg(:,<span class="built_in">j</span>)=cg(:,<span class="built_in">j</span>)/<span class="built_in">max</span>(<span class="built_in">abs</span>(cg(:,<span class="built_in">j</span>)));</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">if</span> mut_r==<span class="number">1</span>    <span class="comment">%消减反射波</span></span><br><span class="line">        uper_1(pos:ng,<span class="number">1</span>)=<span class="built_in">round</span>(uper(<span class="number">1</span>:ng-pos+<span class="number">1</span>,<span class="number">2</span>));   <span class="comment">% ng-is 总列数-图号（震源位置）</span></span><br><span class="line">        uper_1(<span class="number">1</span>:pos<span class="number">-1</span>,<span class="number">1</span>)=<span class="built_in">round</span>(<span class="built_in">flipud</span>(uper(<span class="number">1</span>:pos<span class="number">-1</span>,<span class="number">2</span>)));<span class="comment">% 翻转对称性质，地震道关于震源位置对称</span></span><br><span class="line">        lower_1(pos:ng,<span class="number">1</span>)=<span class="built_in">round</span>(lower(<span class="number">1</span>:ng-pos+<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">        lower_1(<span class="number">1</span>:pos<span class="number">-1</span>,<span class="number">1</span>)=<span class="built_in">round</span>(<span class="built_in">flipud</span>(lower(<span class="number">1</span>:pos<span class="number">-1</span>,<span class="number">2</span>)));</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:ng  <span class="comment">%列号</span></span><br><span class="line">            st=uper_1(<span class="built_in">j</span>)-tap_size;</span><br><span class="line">            ed=lower_1(<span class="built_in">j</span>)+tap_size;</span><br><span class="line">            <span class="keyword">if</span> st&gt;<span class="number">0</span>; cg(<span class="number">1</span>:st,<span class="built_in">j</span>)=<span class="number">0</span>; <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">if</span> ed&lt;nt; cg(ed:<span class="keyword">end</span>,<span class="built_in">j</span>)=<span class="number">0</span>; <span class="keyword">end</span>   <span class="comment">%第j列，st、ed之间的所有行保留，其余清零</span></span><br><span class="line">            <span class="keyword">for</span> k=<span class="number">1</span>:tap_size</span><br><span class="line">                st1=st+k<span class="number">-1</span>;</span><br><span class="line">                ed1=ed-k+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> st1&gt;<span class="number">0</span>; cg(st1,<span class="built_in">j</span>)=cg(st1,<span class="built_in">j</span>)*k/tap_size; <span class="keyword">end</span>        <span class="comment">%在窗口外围至tap区域，逐渐削弱记录值</span></span><br><span class="line">                <span class="keyword">if</span> ed1&lt;nt; cg(ed1,<span class="built_in">j</span>)=cg(ed1,<span class="built_in">j</span>)*k/tap_size; <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    data(:,:,is)=cg;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h5 id="2-卷积互相关"><a href="#2-卷积互相关" class="headerlink" title="2.卷积互相关"></a>2.卷积互相关</h5><p>其中，只能处理连续放炮，不能处理间隔几个检波器放炮的情况。</p>
<p>代码：</p>
<p>成果图显示：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:ns</span><br><span class="line">    g=data(:,:,<span class="built_in">i</span>);</span><br><span class="line">    s=svshot(:,:,<span class="built_in">i</span>);</span><br><span class="line">    subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="comment">%wigg(g,3,dt,4);</span></span><br><span class="line">    imagesc(g);</span><br><span class="line">    caxis([<span class="number">-0.1</span> <span class="number">0.1</span>])</span><br><span class="line">    title([<span class="string">'Original CSG # '</span>,num2str(<span class="built_in">i</span>)]);</span><br><span class="line">    subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line">    imagesc(s);</span><br><span class="line">    caxis([<span class="number">-0.1</span> <span class="number">0.1</span>])</span><br><span class="line">    title([<span class="string">'Super Virtual CSG # '</span>,num2str(<span class="built_in">i</span>)]);</span><br><span class="line">    pause(<span class="number">0.5</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h1 id="三、测试"><a href="#三、测试" class="headerlink" title="三、测试"></a>三、测试</h1><h1 id="四、打包发布"><a href="#四、打包发布" class="headerlink" title="四、打包发布"></a>四、打包发布</h1><p>命令行输入deploytool</p>
<p>需要matlab运行库的支持，支持库大小为621M , 若选用在线安装，则需再安装500M 运行库在线下载，速度过慢。</p>
<p>第一版完成日期： 2019.10.25</p>

        </div>

        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/MATLAB/"># MATLAB</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2019/10/18/地震作业/">地震作业</a>
            
            
            <a class="next" rel="next" href="/2019/10/12/2D-wave-function/">2D wave function</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Zhang Bai | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
